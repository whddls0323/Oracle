/*
    날짜: 2025/07/23
    이름: 윤종인
    내용: SQL 연습문제4
*/

--실습 1
ALTER SESSION Set "_ORACLE_SCRIPT"=true;
CREATE USER library IDENTIFIED BY 1234;
GRANT CONNECT, RESOURCE, UNLIMITED TABLESPACE TO library;

--실습 2
create table member(
    member_id number(4) primary key,
    name varchar2(40) not null,
    address varchar2(100) default null,
    hp char(13) default null,
    join_date date
);
create table book(
    book_id number(5) primary key,
    title varchar2(50) not null,
    author varchar2(40) not null,
    publisher varchar2(40) not null,
    available char(1),
    reg_date date not null
);
create table loan(
    loan_id number generated by default as identity primary key,
    member_id number(4) not null,
    book_id number(5) not null,
    loan_date date,
    return_date date,
    actual_date date,
    foreign key(member_id) references member(member_id),
    foreign key(book_id) references book(book_id)
);
--실습 3
insert into member values(1001,'김유신','서울특별시 강남구 역삼동','010-1234-1001','2024-01-10 09:15:00');
insert into member values(1002,'김춘추','대전광역시 유성구 장대동','010-1234-1002','2024-02-14 14:30:45');
insert into member values(1003,'장보고','대구광역시 수성구 반월동','010-1234-1003','2024-03-01 11:05:20');
insert into member values(1004,'강감찬','부산광역시 금정구 부곡동','010-1234-1004','2024-03-22 16:40:00');
insert into member values(1005,'이순신','광주광역시 광산구 우산동','010-1234-1005','2024-04-10 08:50:10');

insert into book values(10001,'태백산맥','조정래','문학수첩','Y','2014-01-10 09:15:00');
insert into book values(10002,'데미안','헤르만 헤세','민음사','N','2014-02-14 14:30:45');
insert into book values(10003,'토지','박경리','문학사상사','Y','2014-03-01 11:05:20');
insert into book values(10004,'명품 자바 프로그래밍','제임스 고슬링','한빛출판사','Y','2014-03-22 16:40:00');
insert into book values(10005,'로미오와 줄리엣','세익스피어','열린책들','N','2014-04-10 08:50:10');
insert into book values(10006,'삼국지','나관중','민음사','Y','2014-04-05 09:12:02');
insert into book values(10007,'칼의 노래','김훈','문학동네','Y','2014-06-10 12:53:17');
insert into book values(10008,'데이터베이스','래리 엘리슨','한빛출판사','N','2014-05-23 10:13:09');
insert into book values(10009,'Linux 운영체제','리누스 토발즈','한빛출판사','Y','2014-03-11 11:23:43');
insert into book values(10010,'어린 왕자','생텍쥐베리','열린책들','Y','2014-05-13 15:27:21');

insert into loan(member_id,book_id,loan_date,return_date,actual_date) values(1001,10002,'2024-03-01 10:02:31','2024-03-15 10:02:31','2024-03-13 09:44:19');
insert into loan(member_id,book_id,loan_date,return_date,actual_date) values(1002,10004,'2024-03-05 15:10:02','2024-03-19 15:10:02','2024-03-12 17:12:30');
insert into loan(member_id,book_id,loan_date,return_date,actual_date) values(1003,10008,'2024-04-01 11:01:12','2024-04-15 11:01:12',null);
insert into loan(member_id,book_id,loan_date,return_date,actual_date) values(1002,10001,'2024-04-10 14:32:01','2024-04-24 14:32:01','2024-04-22 13:56:32');
insert into loan(member_id,book_id,loan_date,return_date,actual_date) values(1005,10004,'2024-04-15 16:24:21','2024-04-29 16:24:21',null);
insert into loan(member_id,book_id,loan_date,return_date,actual_date) values(1004,10006,'2024-05-01 09:12:09','2024-05-15 09:12:09','2024-05-14 09:21:27');
insert into loan(member_id,book_id,loan_date,return_date,actual_date) values(1001,10007,'2024-05-03 13:51:07','2024-05-17 13:51:07','2024-05-16 14:05:10');
insert into loan(member_id,book_id,loan_date,return_date,actual_date) values(1003,10009,'2024-06-01 11:15:43','2024-06-15 11:15:43',null);
insert into loan(member_id,book_id,loan_date,return_date,actual_date) values(1004,10004,'2024-06-02 12:30:52','2024-06-16 12:30:52',null);
insert into loan(member_id,book_id,loan_date,return_date,actual_date) values(1002,10008,'2024-06-05 10:06:17','2024-06-19 10:06:17',null);

--실습 4
select member_id,name,hp,address from member;

--실습 5
select title,author from book;

--실습 6
select name,address from member where address like '부산%';

--실습 7
select title from book where available='Y';

--실습 8
select * from book where book_id='10005';

--실습 9
select member_id,name,hp from member where member_id=1002;

--실습 10
select title from book where substr(reg_date,1,7)='2014-03';

--실습 11
select title,author,publisher from book where publisher='민음사';

--실습 12
select loan_id,member_id,book_id from loan where actual_date is null;

--실습 13
select * from member where name like '김%';

--실습 14
select name,address from member where address like '부산%' or address like '대구%';

--실습 15
select book_id,title from book where book_id in (10003,10006);

--실습 16
select title,author from book where author in ('조정래','박경리');

--실습 17
select name,join_date from member where join_date < '2024-04-01';

--실습 18
select loan_id,member_id,book_id,loan_date from loan where loan_date > '2024-05-01';

--실습 19
select title,author,publisher from book where available='N';

--실습 20
select * from book where title like '%자바%';

--실습 21
select name,hp from member where hp not in ('010-1234-1003');

--실습 22
select loan_id,member_id,book_id from loan where return_date < '2024-03-20';

--실습 23
select * from member order by name;

--실습 24
select title,reg_date from book order by reg_date desc;

--실습 25
select title from book order by title fetch first 3 rows only;

--실습 26
select * from member order by join_date desc fetch first 1 rows only;

--실습 27
select loan_id,loan_date from loan order by loan_date fetch first 2 rows only;

--실습 28
select count(*) from member;

--실습 29
select count(*) from book;

--실습 30
select count(*) from book where available='Y';

--실습 31
select publisher,count(*) as 출판_도서수 from book group by publisher;

--실습 32
select count(*) from loan where loan_date like '2024%';

--실습 33
select member_id,count(*) as 대출_도서수 from loan group by member_id;

--실습 34
select book_id,count(*) as 대출횟수 from loan group by book_id;

--실습 35
select member_id,count(*) as 회원_대출건수 from loan group by member_id having count(*) >= 2;

--실습 36
select book_id,count(*) as 도서_대출건수 from loan group by book_id having count(*) >= 2;

--실습 37
select l.member_id,name,l.book_id,title,loan_date from book b join loan l on b.book_id=l.book_id join member m on l.member_id=m.member_id;

--실습 38
select name,count(*) from member m join loan l on m.member_id=l.member_id group by name having count(*) >= 3;

--실습 39
select loan_id,name,title,loan_date from book b join loan l on b.book_id=l.book_id join member m on l.member_id=m.member_id where loan_date < '2024-05-01';

--실습 40
select title from book b join loan l on b.book_id=l.book_id join member m on l.member_id=m.member_id where name='김유신';

--실습 41
select name from book b join loan l on b.book_id=l.book_id join member m on l.member_id=m.member_id where title='태백산맥';

--실습 42
select name,title from book b join loan l on b.book_id=l.book_id join member m on l.member_id=m.member_id where name='김춘추' order by title;

--실습 43
select title,name from book b join loan l on b.book_id=l.book_id join member m on l.member_id=m.member_id where loan_date like '2024-04%';

--실습 44
select name,title from book b join loan l on b.book_id=l.book_id join member m on l.member_id=m.member_id where actual_date is null;

--실습 45
select name,title from book b join loan l on b.book_id=l.book_id join member m on l.member_id=m.member_id where author='조정래';

--실습 46
select b.book_id,title from book b left join loan l on b.book_id=l.book_id where loan_id is null; //해결못함

--실습 47
select name,count(*) as 총_건수 from loan l join member m on l.member_id=m.member_id group by l.member_id,name order by 총_건수 desc;

--실습 48
select name from member where member_id=(
select member_id from loan 
group by member_id order by count(*) desc fetch first 1 rows only);

--실습 49
select distinct title from book where publisher=(select publisher from book where title='데이터베이스') and title not in ('데이터베이스'); //해결못함

--실습 50
select name from member where member_id in (
select member_id from loan where book_id=10004);
